<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>User</title>
</head>

<body>
    <%- include("../components/header", isLoggedIn, user_id, image) %>
    <main>
        <%- include("../components/nav") %>
        <article>
            <article class="card__list">
                <div class="card__profile">
                    <header class="profile__header">
                        <% users.forEach(item => { %>
                            <% if (item.user_id == id) { %>
                                <% if (item.profile != '') { %>
                                    <img src="/images/<%= item.profile %>" alt="" width="50" height="50">
                                <% } else { %>
                                    <img src="/images/Unknown_person.jpg" alt="" width="50" height="50">
                                <% } %>
                            <% } %>
                        <% }) %>
                        <div class="profile__details">
                            <h4><%= user.name %></h4>
                            <p><%= user.username %></p>
                        </div>
                        <i class="fas fa-flag profile__flag" id = "report"></i>

                        <div class="reportShow" id = "reportget">
                            <div class="reportdata">
                                <div class="report-header">
                                    <span class="close-report">&times;</span>
                                    <h1>Report This User</h1>
                                    <p>Help us understand the problem. What issue with <a href="/users/<%= user.user_id %>"><%= user.username %></a></p> are you reporting?</p>
                                  </div>
                                  <div class="report-body">
                                      <% if (user_id == user.user_id) { %>
                                        <form action="/createreport" method = "POST">
                                         <p id = "reporterr">you can't report yourself</p>
                                         <div id = "submit" style = "margin: 20px auto;"></div>
                                        </form>
                                      <% } else { %>
                                            <form action="/createreport" method = "POST">
                                                <p id = "reporterr"></p>
                                                <input type="hidden" name="user_id" id="user_id" value = <%= user.user_id %>>
                                                <input type="hidden" name = "post_id" id = "post_id" value = '' autocomplete="off">
                                                <br>
                                                <input type="radio" id = "info1" name = "description" autocomplete="off" value = "I'm not interested in this account" required>
                                                <label for="info1">I'm not interested in this account</label><br><br>
                                                <input type="radio" id = "info2" name = "description" autocomplete="off" value = "This user is a popsicle spammer">
                                                <label for="info2">This user is a popsicle spammer</label><br><br>
                                                <input type="radio" id = "info3" name = "description" autocomplete="off" value = "It appears their account is hacked">
                                                <label for="info3">It appears their account is hacked</label><br><br>
                                                <input type="radio" id = "info4" name = "description" autocomplete="off" value = "They're pretending to be me or someone else">
                                                <label for="info4">They're pretending to be me or someone else</label><br><br>
                                                <input type="radio" id = "info5" name = "description" autocomplete="off" value = "Their posts are abusive or hateful">
                                                <label for="info5">Their posts are abusive or hateful</label><br><br>
                                                <input type="radio" id = "info6" name = "description" autocomplete="off" value = "Their profile images include abusive or hateful content">
                                                <label for="info6">Their profile images include abusive or hateful content</label><br>
                                                <div class="report-button">
                                                <button type = 'submit' id = 'submit' class = 'btnreport'>Submit</button>
                                            </div>
                                        </form>
                                      <% } %>
                                  </div>
                            </div>
                        </div>

                        <% if (typeof follow == 'object' && follow) { %>
                        <% let filteredFollow = follow.filter((v) => { return v.user_id === user.user_id }) %>
                        <% if (filteredFollow.length > 0) { %>
                        <% followStatus = "Unfollow" %>
                        <% } else { %>
                        <% followStatus = "Follow" %>
                        <% } %>
                        <% } else { %>
                        <% followStatus = "Follow" %>
                        <% } %>
                        <% if (typeof isLoggedIn == 'boolean' && isLoggedIn) { %>
                        <% if (followStatus === "Unfollow") { %>
                        <button data-follow-status="<%= followStatus %>" data-user-id="<%= user.user_id %>"
                            onclick="follow(event)"
                            class="profile__follow profile__follow--active"><%= followStatus %></button>
                        <% } else { %>
                        <button data-follow-status="<%= followStatus %>" data-user-id="<%= user.user_id %>"
                            onclick="follow(event)" class="profile__follow"><%= followStatus %></button>
                        <% } %>
                        <% } else { %>
                        <a href="/login">Follow</a>
                        <% } %>
                    </header>
                    <div class="profile__stats">
                        <div>
                            <h2><%= stats.Followers %></h2>
                            <p>Followers</p>
                        </div>
                        <div>
                            <h2><%= stats.Likes %></h2>
                            <p>Likes</line-height cssp>
                        </div>
                        <div>
                            <h2><%= stats.Posts %></h2>
                            <p>Post Created</p>
                        </div>
                    </div>
                </div>
                <div>
                    <p>My Albums</p>
                </div>
                <div class="album__card">
                    <% albums.forEach(item => { %>
                        <div class="item">
                            <a href="/album/<%= item.album_id %>">
                                <div class="img-album">
                                    <img src="/images/<%= item.album_cover %> " alt="" width = "100%" height="200px">
                                </div>
                                <div class="album-content">
                                    <h1><%= item.album_name %> </h1>
                                    <p><%= item.album_description %> </p>
                                </div>
                            </a>
                        </div>
                    <% }) %>

                    <div class="item-select">
                        <a href="/createalbum"><p>+ Add New Album</p></a>
                    </div>
                </div>
                <div>
                    <p>My Posts</p>
                </div>
                <% posts.forEach(item => { %>
                <% if (typeof likes == 'object' && likes) { %>
                <% let filtered = likes.filter((v) => { return v.post_id === item.post_id }) %>
                <% if (filtered.length > 0) { %>
                <% status = "Unlike" %>
                <% } else { %>
                <% status = "Like" %>
                <% } %>
                <% } else { %>
                <% status = "Like" %>
                <% } %>
                <div class="card card__post">
                    <div class="card__like">
                        <% if (typeof isLoggedIn == 'boolean' && isLoggedIn) { %>
                        <% if (status === "Unlike") { %>
                        <i class="fas fa-heart active" onclick="actOnPost(event)" data-post-id="<%= item.post_id %>"
                            data-post-status="<%= status %>"></i>
                        <% } else { %>
                        <i class="far fa-heart" onclick="actOnPost(event)" data-post-id="<%= item.post_id %>"
                            data-post-status="<%= status %>"></i>
                        <% } %>
                        <% } else { %>
                        <a href="/login"><i class="far fa-heart"></i></a>
                        <% } %>
                        <p id="likes-count-<%= item.post_id %>"><%= item.likes %></p>
                    </div>
                    <div class="card__content">
                        <div class="card__header">
                            <h3><%= item.post_title %> </h3>
                            <a href = "/report/post/<%= item.post_id %>"><i class="fas fa-flag post__flag" role = "button"></i></a>
                           <a href = "/editpost/<%= item.post_id %>" style = "margin-left: auto;"><i class="fas fa-edit" role = "button"></i></a>
                        <i class="far fa-trash-alt" role="button" onclick=<%='del(' + item.post_id +')' %>></i>
                        </div>
                        <p><%= item.post_content %> </p>
                        <hr>
                        <div class="card__info">
                            <% if (item.profile == '') { %>
                                <img src="/images/Unknown_person.jpg" alt="" width="35" height="35">
                            <% } else { %>
                                <img src="/images/<%= item.profile %>" alt="" width="35" height="35">
                            <% } %>
                            <p>Posted By <a href="/users/<%= item.user_id %>"><%= item.username %> </a></p>
                            <a href="/posts/<%= item.post_id %>"><i class="far fa-comment-alt"></i></a>
                        </div>
                    </div>
                </div>
                <% }) %>
            </article>
        </article>
        <div><a class="createpost" href="/createpost">Create a New Post</a></div>
    </main>
    <%- include("../components/scripts_links") %>
    <script>
        const error = 'please select one of the following options';
        const errTitle = document.getElementById('reporterr');
        let hear = document.getElementsByName('description');
        let is_checked = false;

        let button = document.getElementById('submit');
        button.onclick = function() {
            for (let i = 0; i < hear.length; i++) {
                if(hear[i].checked){
                    is_checked = true;
                    break;
                };
                if(!is_checked){
                    errTitle.innerHTML = error;
                };
            };
        };

        let content = document.getElementById('reportget');

        let icon = document.getElementById('report');

        let stop = document.getElementsByClassName('close-report')[0];

        icon.onclick = function() {
            content.style.display = 'block';
        };

        stop.onclick = function(){
            content.style.display = 'none';
        };

        window.addEventListener('click', function(e){
            if(e.target == content){
                content.style.display = 'none';
            }
        });
        
        let del = (id) => {
            axios.delete('/api/post/' + id)
            .then((result) => {
                location.reload();
            }).catch((err) => {
                alert('error ' + err)
            });
        };
    </script>
</body>

</html>